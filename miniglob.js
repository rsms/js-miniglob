var E=Object.defineProperty,z=e=>E(e,"__esModule",{value:!0}),L=(e,t)=>{z(e);for(var r in t)E(e,r,{get:t[r],enumerable:!0})};L(exports,{PatternError:()=>a,glob:()=>W,match:()=>y});var{readdirSync:_,statSync:D}=require("fs"),h=(()=>{try{return require("path").sep}catch(e){return"/"}})(),u=h.charCodeAt(0),T=h==":"?/\:+/g:h=="\\"?/\\+/g:/\/+/g,x=process.platform=="win32",a=class extends Error{constructor(){super("bad pattern")}};function W(e){if(e.indexOf("**")<0)return S(e);let t=[],r=new Set;return m("",e.split(/\*{2,}/),0,t,r),t}function c(){}var Y=x?e=>{if(e.length<2)return 0;let t=e[0];return e[1]==":"&&("a"<=t&&t<="z"||"A"<=t&&t<="Z")?2:0}:e=>0,Z=x?(e,t)=>{let r=t(e);return e==""?[0,"."]:r+1==e.length&&B(e,e.length-1)?[r+1,e]:r==e.length&&e.length==2?[r,e+"."]:(r>=e.length&&(r=e.length-1),[r,e.substr(0,e.length-1)])}:(e,t)=>e==""?[t,"."]:e==h?[t,e]:[t,e.substr(0,e.length-1)];function B(e,t){return e.charCodeAt(t)===u}function H(e){let t=e.length-1,r=t;for(;e.charCodeAt(r)===u;)r--;return r!=t?e.substr(0,r+1):e}function J(e){let t=0,r=t;for(;e.charCodeAt(r)===u;)r++;return r!=t?e.substr(r):e}function m(e,t,r,l,n){r>=t.length&&(r=t.length-1);let i=t[r],o=i;r===0?i.charCodeAt(i.length-1)!=u&&(o+="*"):r===t.length-1?i.charCodeAt(0)!=u&&(o="*"+o):(i.charCodeAt(0)!=u&&(o="*"+o),i.charCodeAt(i.length-1)!=u&&(o+="*"));function f(s){return n.has(s)?!1:(n.add(s),!0)}function w(s){let g=s,A=g.lastIndexOf(h);A!=-1&&(g=g.substr(A+1));let F=Math.min(r+1,t.length-1),b=t.slice(F).join("*");b.charCodeAt(0)==u?b=J(b):b[0]!="*"&&(b="*"+b),y(b,g)&&l.push(s)}e&&(o[0]!=h?o=e+h+o:o=e+o);let d=!1;o.charCodeAt(o.length-1)===u&&(d=!0,o=H(o));let C=S(o);for(let s of C){let g=D(s);g.isDirectory()?f(s)&&K(s,(A,F)=>{f(A)&&(F.isDirectory()?m(A,t,r+1,l,n):w(A))}):!d&&f(s)&&w(s)}return l}function K(e,t){e=N(e);let r=D(e);r.isDirectory()&&R(e,t,new Set([r.ino]))}function R(e,t,r){for(let l of _(e)){let n=j(e,l),i=P(n),o=t(n,i);(o||o===void 0)&&i&&i.isDirectory()&&!r.has(i.ino)&&(r.add(i.ino),R(n,t,r))}}function S(e){let t=[];if(!G(e))return P(e)?[e]:t;let r=Y(e),l=e.length-1;for(;l>=r&&!B(e,l);)l--;let n=e.substr(0,l+1),i=e.substr(l+1);if([r,n]=Z(n,r),!G(n.substr(r)))q(n,i,t);else{if(n==e)throw new a;let o=S(n);for(let f of o)q(f,i,t)}return t}function q(e,t,r){let l=P(e);if(l===null)return;if(!l.isDirectory())return;let n;try{n=_(e)}catch(i){return}n.sort();for(let i of n)y(t,i)&&r.push(j(e,i))}function G(e){for(let t=0;t<e.length;++t)switch(e.charCodeAt(t)){case 42:case 63:case 91:case 123:return!0}return!1}function Q(e,t){for(let r=0;r<e.length;++r)if(e.charCodeAt(r)===t)return!0;return!1}function y(e,t){e:for(;e.length>0;){let r=!1,l="",n=e;if([r,l,e]=U(e),c("scanChunk(%o) => %o",n,[r,l,e]),r&&l=="")return c("ret"),!Q(t,u);let[i,o]=M(l,t);if(c("matchChunk(%o, %o) => %o",l,t,[i,o]),o&&(i.length==0||e.length>0)){t=i;continue}if(r){for(let f=0;f<t.length&&t.charCodeAt(f)!=u;f++)if([i,o]=M(l,t.substr(f+1)),o){if(e.length==0&&i.length>0)continue;t=i;continue e}}return!1}return t.length==0}function U(e){let t=!1;for(;e.length>0&&e.charCodeAt(0)==42;)e=e.substr(1),t=!0;let r=!1,l=0>>0;e:for(;l<e.length;l++)switch(e.charCodeAt(l)){case 92:x||l+1<e.length&&l++;break;case 91:r=!0;break;case 93:r=!1;break;case 42:if(!r)break e;break}return[t,e.substr(0,l),e.substr(l)]}function M(e,t){for(c("enter matchChunk(%o, %o)",e,t);e.length>0;){if(t.length==0)return["",!1];switch(e.charCodeAt(0)){case 91:{let n=t.codePointAt(0),i=n<=65535?1:2;if(t=t.substr(i),e=e.substr(1),c('"[" s reduced to %o, chunk reduced to %o, r = 0x%s',t,e,n.toString(16)),e.length==0)throw new a;let o=e.charCodeAt(0)==94;o&&(c('"[" negation from "^"'),e=e.substr(1));let f=!1,w=0;for(;;){if(e.length>0&&e.charCodeAt(0)==93&&w>0){c('"[" loop break at A'),e=e.substr(1);break}let d,C,s=e;if([C,e,d]=O(e),c('"[" loop getEsc(%o) => %o',s,[C,e,d]),!d)return c('"[" loop return at B from failed getEsc'),["",!1];let g=C;if(e.charCodeAt(0)==45&&([g,e,d]=O(e.substr(1)),!d))return["",!1];C<=n&&n<=g&&(f=!0),w++}if(f==o)return["",!1];break}case 63:if(t.charCodeAt(0)==u)return["",!1];let r=t.codePointAt(0),l=r<=65535?1:2;t=t.substr(l),e=e.substr(1);break;case 92:if(!x&&(c('"\\" consume'),e=e.substr(1),e.length==0))throw new a;default:if(e.charCodeAt(0)!=t.charCodeAt(0))return c("[def] chunk[0] != s[0] (%o != %o) (0x%s != 0x%s) -- return",e[0],t[0],e.charCodeAt(0).toString(16),t.charCodeAt(0).toString(16)),["",!1];t=t.substr(1),e=e.substr(1),c("[def] s reduced to %o, chunk reduced to %o",t,e);break}}return[t,!0]}function O(e){let t=0,r="",l=e.charCodeAt(0);if(e.length==0||l==45||l==93)throw new a;if(l==92&&!x&&(e=e.substr(1),e.length==0))throw new a;t=e.codePointAt(0);let n=t<=65535?1:2;if(t==65535&&n==1)throw new a;if(r=e.substr(n),r.length==0)throw new a;return[t,r,!0]}function P(e){try{return D(e)}catch(t){}return null}function j(e,t){return e=="."||e==""?t:e+h+t}function N(e){let t=e.length-1,r=t;for(;r&&e.charCodeAt(r)===u;)--r;return r!=t&&(e=e.substr(0,r+1)),e.split(T).join(h)}
//# sourceMappingURL=miniglob.js.map
